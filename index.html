<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creator Platform</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
        }
        .text-glow {
            text-shadow: 0 0 8px rgba(0, 0, 0, 0.2);
        }
        .profile-container:hover .overlay {
            opacity: 1;
        }
        .profile-container:hover .profile-pic {
            opacity: 0.5;
        }
    </style>
</head>
<body class="antialiased">

    <!-- Header & Navigation -->
    <header class="bg-white shadow-sm sticky top-0 z-50">
        <nav class="container mx-auto px-4 py-4 flex justify-between items-center">
            <a href="#" class="text-2xl font-bold text-gray-800">Creator Hub</a>
            <div class="space-x-4">
                <button id="auth-button" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-full hover:bg-blue-700 transition duration-300">
                    Sign In
                </button>
            </div>
        </nav>
    </header>

    <main class="container mx-auto px-4 py-8">
        <!-- Main Profile Section -->
        <section id="profile-section" class="bg-white rounded-2xl shadow-xl p-6 md:p-10 mb-8 max-w-4xl mx-auto">
            <div class="flex flex-col md:flex-row items-center md:items-start space-y-6 md:space-y-0 md:space-x-8">
                <div class="flex-shrink-0 relative group profile-container">
                    <a href="https://www.instagram.com/theinsanelavanya" target="_blank">
                        <!-- DIRECT IMAGE URL ADDED -->
                        <img id="profile-pic" src="https://i.postimg.cc/9Q8zcP49/Gemini-Generated-Image-yij304yij304yij3.png" alt="Profile Picture" class="profile-pic w-32 h-32 md:w-40 md:h-40 rounded-full object-cover border-4 border-white shadow-lg transition-all">
                    </a>
                    <label for="profile-pic-upload" class="overlay absolute inset-0 flex items-center justify-center cursor-pointer opacity-0 transition-opacity">
                        <span class="text-white text-center font-bold px-4 py-2 rounded-full bg-black bg-opacity-50">Change Photo</span>
                        <input type="file" id="profile-pic-upload" accept="image/*" class="hidden">
                    </label>
                </div>
                <div class="flex-grow text-center md:text-left">
                    <h1 class="text-4xl md:text-5xl font-extrabold text-gray-900 mb-2 leading-tight">Lavanya Singh</h1>
                    <p class="text-lg text-gray-500 mb-4">@theinsanelavanya</p>
                    <p class="text-gray-700 text-lg mb-6 max-w-2xl mx-auto md:mx-0">
                        Hello and welcome! I'm a content creator excited to share my journey, insights, and behind-the-scenes moments. Join me for exclusive content!
                    </p>
                    <div class="flex justify-center md:justify-start space-x-4 mb-4">
                        <span class="bg-gray-200 text-gray-800 px-3 py-1 rounded-full text-sm font-medium">10K Subscribers</span>
                        <span class="bg-gray-200 text-gray-800 px-3 py-1 rounded-full text-sm font-medium">150 Posts</span>
                    </div>
                    <a href="https://www.instagram.com/theinsanelavanya" target="_blank" class="bg-pink-600 text-white font-bold py-3 px-8 rounded-full hover:bg-pink-700 transition duration-300 transform hover:scale-105 inline-block">
                        View on Instagram
                    </a>
                </div>
            </div>
            <!-- Photo Gallery -->
            <div class="mt-10">
                <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">Gallery</h2>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <img src="https://i.postimg.cc/yx1zJ5t8/rendernet-media-img-Fc-O3e-Vc-Pk-P-1.png" alt="Gallery Photo 1" class="rounded-lg shadow-md w-full h-auto object-cover">
                    <img src="https://i.postimg.cc/8cZgL4gB/rendernet-media-img-o-XBOnu2-DG7.png" alt="Gallery Photo 2" class="rounded-lg shadow-md w-full h-auto object-cover">
                    <img src="https://i.postimg.cc/k4dCCDy8/rendernet-media-img-RWVtm-TW6-Q6.png" alt="Gallery Photo 3" class="rounded-lg shadow-md w-full h-auto object-cover">
                    <img src="https://i.postimg.cc/3w2XNb26/rendernet-media-img-S3-M1-Hqs-Z0-X-1.png" alt="Gallery Photo 4" class="rounded-lg shadow-md w-full h-auto object-cover">
                </div>
            </div>
        </section>

        <!-- Content Feed Section -->
        <section id="content-feed" class="max-w-4xl mx-auto">
            <div id="posts-container" class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Posts will be dynamically inserted here -->
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-2">My First Post!</h3>
                    <p class="text-gray-600 text-sm mb-4">Posted on Aug 31, 2025</p>
                    <img src="https://i.postimg.cc/85w0YCXT/Picsart-25-09-01-15-38-01-735.png" alt="Post Image" class="w-full h-auto rounded-lg object-cover mb-4">
                    <p class="text-gray-700">This is a public post that anyone can see. It's a great way to welcome new visitors to my page and share a bit about what I do.</p>
                </div>
                <!-- Locked Post Example -->
                <div class="relative bg-gray-200 rounded-xl shadow-md p-6 overflow-hidden">
                    <div id="locked-content" class="absolute inset-0 flex items-center justify-center bg-gray-900 bg-opacity-80 backdrop-blur-sm z-10">
                        <div class="text-center text-white">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                            </svg>
                            <p class="text-lg font-bold">This content is locked.</p>
                            <p class="text-sm">Subscribe to unlock all posts!</p>
                        </div>
                    </div>
                    <h3 class="text-xl font-bold text-gray-800 mb-2">My Exclusive Content</h3>
                    <p class="text-gray-600 text-sm mb-4">Posted on Aug 30, 2025</p>
                    <img src="https://i.postimg.cc/TPT8NB2q/Picsart-25-09-01-16-09-18-093.png" alt="Post Image" class="w-full h-auto rounded-lg object-cover mb-4 filter blur-sm">
                    <p class="text-gray-700">${post.content}</p>
                </div>
                <!-- The actual posts from Firestore will be appended here -->
                <div class="relative bg-gray-200 rounded-xl shadow-md p-6 overflow-hidden">
                    <div id="locked-content-qna" class="absolute inset-0 flex items-center justify-center bg-gray-900 bg-opacity-80 backdrop-blur-sm z-10">
                        <div class="text-center text-white">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                            </svg>
                            <p class="text-lg font-bold">This content is locked.</p>
                            <p class="text-sm">Subscribe to unlock all posts!</p>
                        </div>
                    </div>
                    <h3 class="text-xl font-bold text-gray-800 mb-2">Q&A Session</h3>
                    <p class="text-gray-600 text-sm mb-4">Posted on Aug 30, 2025</p>
                    <img src="https://i.postimg.cc/RCXksg2w/Picsart-25-09-01-15-33-05-061.png" alt="Post Image" class="w-full h-auto rounded-lg object-cover mb-4 filter blur-sm">
                    <p class="text-gray-700">I'm answering your most-asked questions in this exclusive Q&A video!</p>
                </div>
            </div>
        </section>
    </main>

    <!-- Modal for auth status -->
    <div id="auth-modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 hidden flex items-center justify-center">
        <div class="bg-white rounded-xl shadow-xl p-8 max-w-sm mx-auto text-center transform transition-all sm:my-8 sm:align-middle sm:max-w-lg">
            <h3 id="modal-title" class="text-2xl font-bold text-gray-800 mb-4"></h3>
            <p id="modal-text" class="text-gray-600 mb-6"></p>
            <button id="close-modal" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-full hover:bg-blue-700 transition duration-300">Close</button>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const profilePicUpload = document.getElementById('profile-pic-upload');
            const profilePic = document.getElementById('profile-pic');
            
            profilePicUpload.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        profilePic.src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            });
        });
    </script>
    
    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithCustomToken, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, getDocs, setDoc, doc, getDoc, onSnapshot, query, where, addDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // Set Firebase debug logs
        setLogLevel('Debug');

        // Firestore Security Rules require a user to be authenticated.
        // We will authenticate a user automatically.
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        
        const authButton = document.getElementById('auth-button');
        const authModal = document.getElementById('auth-modal');
        const closeModalButton = document.getElementById('close-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalText = document.getElementById('modal-text');

        // Authentication State Management
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                authButton.textContent = 'Signed In';
                authButton.disabled = true;
                console.log("User signed in with UID:", user.uid);
                await createDummyData(user.uid);
                fetchContentFeed(user.uid);
            } else {
                authButton.textContent = 'Sign In';
                authButton.disabled = false;
                console.log("User is signed out.");
            }
        });

        // Sign in anonymously on page load
        if (typeof __initial_auth_token !== 'undefined') {
             signInWithCustomToken(auth, __initial_auth_token).catch((error) => {
                 console.error("Error signing in with custom token:", error);
                 signInAnonymously(auth); // Fallback to anonymous sign-in
            });
        } else {
             signInAnonymously(auth);
        }

        closeModalButton.addEventListener('click', () => {
            authModal.classList.add('hidden');
        });

        function showModal(title, text) {
            modalTitle.textContent = title;
            modalText.textContent = text;
            authModal.classList.remove('hidden');
        };

        // --- Firestore Data Functions ---

        // This function creates dummy content data if it doesn't already exist.
        // In a real app, this would be content posted by creators.
        async function createDummyData(userId) {
            const postsCollectionRef = collection(db, "artifacts", appId, "public", "data", "posts");
            const snapshot = await getDocs(postsCollectionRef);

            if (snapshot.empty) {
                await addDoc(postsCollectionRef, {
                    creatorId: userId,
                    title: "My First Post!",
                    isLocked: false,
                    imageUrl: "https://i.postimg.cc/85w0YCXT/Picsart-25-09-01-15-38-01-735.png",
                    content: "This is a public post that anyone can see. It's a great way to welcome new visitors to my page and share a bit about what I do.",
                    createdAt: new Date()
                });

                await addDoc(postsCollectionRef, {
                    creatorId: userId,
                    title: "My Exclusive Content",
                    isLocked: true,
                    imageUrl: "https://i.postimg.cc/TPT8NB2q/Picsart-25-09-01-16-09-18-093.png",
                    content: "This content is only for my most dedicated fans and supporters. I'll be sharing my exclusive behind-the-scenes content here!",
                    createdAt: new Date()
                });

                await addDoc(postsCollectionRef, {
                    creatorId: userId,
                    title: "Q&A Session",
                    isLocked: true,
                    imageUrl: "https://i.postimg.cc/RCXksg2w/Picsart-25-09-01-15-33-05-061.png",
                    content: "I'm answering your most-asked questions in this exclusive Q&A video!",
                    createdAt: new Date()
                });

                showModal("Data Created", "Dummy content has been added to the database.");
            }
        }

        // Listen for real-time changes to the content feed
        function fetchContentFeed(userId) {
            const postsContainer = document.getElementById('posts-container');
            const postsCollectionRef = collection(db, "artifacts", appId, "public", "data", "posts");
            const q = query(postsCollectionRef);

            onSnapshot(q, (snapshot) => {
                postsContainer.innerHTML = ''; // Clear previous posts
                snapshot.forEach(doc => {
                    const post = doc.data();
                    const postElement = createPostElement(post, userId);
                    postsContainer.appendChild(postElement);
                });
            }, (error) => {
                console.error("Error fetching documents:", error);
                showModal("Error", "Could not fetch content feed. Please check the console for details.");
            });
        }

        // Create the HTML element for each post
        function createPostElement(post, currentUserId) {
            const isSubscribed = false; // In a real app, this would be a check for the user's subscription status
            const postDiv = document.createElement('div');
            postDiv.className = 'bg-white rounded-xl shadow-md p-6 relative overflow-hidden';

            const isLocked = post.isLocked && !isSubscribed;
            
            if (isLocked) {
                // Add a blur and overlay for locked content
                postDiv.innerHTML = `
                    <div class="relative">
                        <div class="absolute inset-0 flex items-center justify-center bg-gray-900 bg-opacity-80 backdrop-blur-sm z-10">
                            <div class="text-center text-white p-4">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                                </svg>
                                <p class="text-lg font-bold">This content is locked.</p>
                                <p class="text-sm">Subscribe to unlock all posts!</p>
                            </div>
                        </div>
                        <h3 class="text-xl font-bold text-gray-800 mb-2">${post.title}</h3>
                        <p class="text-gray-600 text-sm mb-4">Posted on ${post.createdAt.toDate().toLocaleDateString()}</p>
                        <img src="${post.imageUrl}" alt="Post Image" class="w-full h-auto rounded-lg object-cover mb-4 filter blur-sm">
                        <p class="text-gray-700">${post.content}</p>
                    </div>
                `;
            } else {
                postDiv.innerHTML = `
                    <h3 class="text-xl font-bold text-gray-800 mb-2">${post.title}</h3>
                    <p class="text-gray-600 text-sm mb-4">Posted on ${post.createdAt.toDate().toLocaleDateString()}</p>
                    <img src="${post.imageUrl}" alt="Post Image" class="w-full h-auto rounded-lg object-cover mb-4">
                    <p class="text-gray-700">${post.content}</p>
                `;
            }

            return postDiv;
        }

    </script>
</body>
</html>
